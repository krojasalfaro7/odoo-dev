<odoo>
<data>
<template id="exchange_rate_on_the_web" 
          name="Extended for website_sale.confirmation" 
          inherit_id="website_sale.confirmation">

        <xpath expr="//div[@class='col-md-3 hidden-sm hidden-xs text-muted']/t" position="after">
                
        <t t-if="order.payment_acquirer_id.provider == 'transfer'">

        <!--<span t-esc="order.payment_acquirer_id.provider"></span>-->
        <!--<span t-esc="request.env['payment.acquirer'].sudo().search([('provider','=','transfer')])[0].provider"></span>-->
                
          <!--<div class="panel panel-primary">-->
          <div class="panel panel-info">

            <!--<div class="panel-heading"><div class="text-center">Tasas de Cambio</div></div>-->
            <div class="panel-heading">Tasas de Cambio:</div>

            <!--<div class="panel-body text-black">-->
            <div class="panel-body">
              <!--Estableciendo metodo que calculara la conversion de las distintas monedas-->
              <t t-set="conversion" t-value="request.env['res.currency'].sudo()._get_conversion_rate"></t>

              <!--Obteniendo la moneda principal de la compania-->
              <!--<t t-set="from_current" t-value="request.env['res.config.settings'].sudo().search([])[0].currency_id"></t>-->
              <t t-set="from_current" t-value="order.currency_id"></t>

              
              <!--<t t-foreach="request.env['res.config.settings'].sudo().search([])[1:].currency_id" t-as="from_current_register">-->
                  <!--<t t-set="from_current" t-value="from_current and from_current_register"></t>-->
                <!--<t t-set="from_current" t-value="request.env['res.config.settings'].sudo().search([])[0].currency_id"></t>-->
              <!--</t>-->

              <!--Estableciendo las diferentes monedas para la conversion-->
              <t t-set="to_current" t-value="request.env['res.currency'].sudo().search([])"></t>

              <!--<span t-esc="conversion(from_current, to_current)"></span>-->
            
            <!--<table class="table table-striped table-condensed">-->
              <table class="table">
                  <thead>
                      <tr>
                          <th>Moneda</th>
                          <th>Tasa</th>
                      </tr>
                  </thead>
                  <tbody>
                    <!--Aray que almacena -->
                    <t t-set="tasas" t-value="[]"></t>
                    <t t-foreach="request.env['res.currency'].sudo().search([])" t-as="to_current">
                    <tr>
                      <t t-if="not (to_current.name == from_current.name and to_current.symbol == from_current.symbol)">
                        <td>

                          <span t-esc="from_current.name"></span><span>(</span><b t-esc="from_current.symbol"></b><span>)</span>
                          <b><span t-esc="' / '"></span></b>
                          <span t-esc="to_current.name"></span><span>(</span><b t-esc="to_current.symbol"></b><span>)</span>

                          <t t-set="moneda_tasa_name" t-value="from_current.name+'('+from_current.symbol+')'+' / '+ to_current.name+'('+to_current.symbol+')'"></t>

                        </td>
                        <td>
                          <!--<span t-esc="round(conversion(from_current, to_current),3)"></span>-->
                          <span t-esc="'{0:,.2f}'.format(conversion(from_current, to_current)).replace(',','#').replace('.',',').replace('#','.')"/>
                          <t t-set="moneda_tasa_value" t-value="'{0:,.2f}'.format(conversion(from_current, to_current)).replace(',','#').replace('.',',').replace('#','.')"></t>
                        </td>

                        <!--guardando los valores de las tasas para luego usarlo en el modal-->
                        <t t-esc="tasas.append([moneda_tasa_name, moneda_tasa_value, from_current.symbol, to_current.symbol])"></t>

                      </t>
                    </tr>
                  </t>
                  </tbody>
              </table>
            </div>

            <div class="panel-footer">
                <p>En <b>Ver detalles </b> puede obtener el calculo del total de la orden <b t-field="order.payment_tx_id"> </b> en las diferentes tasas de cambio</p>
              <div class="text-right">
                <button type="button" class="btn btn-primary hidden-xs" data-toggle="modal" data-target="#myModal">Ver detalles</button>
              </div> 
            </div>
          </div>

          <!-- Modal -->
          <div class="modal fade text-black" id="myModal" role="dialog">
            <div class="modal-dialog modal-lg">
            
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                  <h4 class="modal-title text-center">Detalles de las tasas de cambio de la orden: <b t-field="order.payment_tx_id"></b></h4>
                  <em><h5>Haga click sobre el par cambiario para ver el precio de a Orden <b t-field="order.payment_tx_id"></b> al monto de la tasa seleccionada</h5></em>
                  
                </div>

                <div class="modal-body">

                  <!--Botones de accion para calcular la tasa de cambio del pedido-->
                  <table class="table text-center">
                    <tbody>
                      <t t-set="columna" t-value="5"></t>
                      <t t-foreach="tasas" t-as="tasa"> 
                        <t t-if="not columna==0">

                          <td>
                          <!--<button type="button" class="btn btn-default hidden-xs" t-attr-value="tasa[1]" onclick="toggle_rate_order(this.value)">
                           <strong><span t-esc="tasa[0]" class="text-info"/></strong>
                          </button>-->

                          <input type="button" t-att-id="tasa[1]" style="font-weight:bold;" class="btn btn-default hidden-xs text-info" t-att-value="tasa[0]" onclick="toggle_rate_order(this)">
                           <!--<strong><span t-esc="tasa[0]" class="text-info"/></strong>-->
                          </input>
                          </td>

                          <t t-set="columna" t-value="columna-1"></t>
                        </t>
                        <t t-else="">
                          <tr>
                          </tr>
                            <td>
                          <!--<button type="button" class="btn btn-default hidden-xs" t-attr-value="tasa[1]" onclick="toggle_rate_order(this.value)">
                               <strong><span t-esc="tasa[0]" class="text-info"/></strong>
                              </button>-->

                              <input type="button" t-att-id="tasa[1]" style="font-weight:bold;" class="btn btn-default hidden-xs text-info" t-att-value="tasa[0]" onclick="toggle_rate_order(this)">
                           <!--<strong><span t-esc="tasa[0]" class="text-info"/></strong>-->
                          </input>
                            </td>
                            <t t-set="columna" t-value="4"></t>
                        </t>
                      </t>
                    </tbody>
                  </table>


                  <t t-foreach="tasas" t-as="tasa">
                    <t t-set="tasa_moneda" t-value="tasa[0]"></t>
                    <t t-set="valor" t-value="tasa[1].replace('.','').replace(',','.')"></t>
                    <t t-set="from_symbol" t-value="tasa[2]"></t>
                    <t t-set="to_symbol" t-value="tasa[3]"></t>
                              
                    <div name="rate_per_divition" t-att-id="tasa[0]" style="display:none;" class="oe_cart">

                        <span class="text-info"><b><span>Tasa: </span></b><span t-esc="tasa_moneda"></span><strong> = </strong></span><strong><span t-esc=" to_symbol+' '+'{0:,.2f}'.format(float(valor)).replace(',','#').replace('.',',').replace('#','.')"></span></strong>


                    <h3 class="mt32 text-left">
                        <strong>Detalles del Pedido:</strong>
                    </h3>
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th class="td-product_name">Producto</th>
                                <th class="td-qty">Cantidad</th>
                                <th class="text-right td-price">Precio unitario</th>
                                <th class="text-right td-price-total">Subtotal</th>
                            </tr>
                        </thead>


                        <tbody>
                          <tr t-foreach="order.order_line" t-as="line">
                              <td class="td-product_name">
                                  <div>
                                      <a t-attf-href="/shop/product/#{ slug(line.product_id.product_tmpl_id) }">
                                          <strong t-esc="line.product_id.with_context(display_default_code=False).display_name"/>
                                      </a>
                                  </div>
                                  <div class="text-muted hidden-xs small">
                                      <t t-foreach="line.name.splitlines()[1:]" t-as="name_line">
                                          <span><t t-esc="name_line"/></span><br/>
                                      </t>
                                  </div>
                              </td>
                              <td class="td-qty">
                                  <div id="quote_qty">
                                      <span t-esc="int(line.product_uom_qty) == line.product_uom_qty and int(line.product_uom_qty) or line.product_uom_qty"/>
                                      <span class="hidden-xs" t-field="line.product_uom" groups="product.group_uom"/>
                                  </div>
                              </td>

                              <td class="td-price">

                                  <t t-set="tasa_price_unit" t-value="float(valor)*line.price_unit"></t>
                                  <span class="text-right">
                                      <div t-esc="to_symbol+' '+'{0:,.2f}'.format(tasa_price_unit).replace(',','#').replace('.',',').replace('#','.')"/>
                                  </span>


                                  <!--<span class="text-right">
                                      <div t-field="line.price_unit" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: order.pricelist_id.currency_id}"/>
                                  </span>-->
                              </td>

                              <td class="td-price-total">

                                <!--<div class="text-right" t-field="line.price_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: order.pricelist_id.currency_id}"/>-->

                                <t t-set="tasa_price_subtotal" t-value="float(valor)*line.price_subtotal"></t>
                                <div class="text-right" t-esc="to_symbol+' '+'{0:,.2f}'.format(tasa_price_subtotal).replace(',','#').replace('.',',').replace('#','.')"/>

                              </td>

                          </tr>
                        </tbody>



                    </table>
                    <table class="table">
                      <tr>
                          <td class="col-md-8"/>
                          <td class="text-right-not-xs text-left-xs col-sm-2 col-xs-3">Subtotal:</td>
                          <td class="text-right col-sm-2 col-xs-3">

                            <!--<span t-field="order.amount_untaxed" style="white-space: nowrap;" t-options="{'widget': 'monetary','from_currency': order.pricelist_id.currency_id,'display_currency': website.currency_id}"/>-->

                              <t t-set="tasa_amount_untaxed" t-value="float(valor)*order.amount_untaxed"></t>
                              <span t-esc="to_symbol+' '+'{0:,.2f}'.format(tasa_amount_untaxed).replace(',','#').replace('.',',').replace('#','.')" style="white-space: nowrap;"/>

                          </td>
                      </tr>
                      <tr>
                          <td class="noborder"/>
                          <td class="text-right noborder">Impuestos:</td>


                          <td class="text-right-not-xs text-left-xs noborder">

                               <!--<span t-field="order.amount_tax" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'from_currency': order.pricelist_id.currency_id, 'display_currency': website.currency_id}"/>-->
                              <t t-set="tasa_amount_tax" t-value="float(valor)*order.amount_tax"></t>
                              <span t-esc="to_symbol+' '+ '{0:,.2f}'.format(tasa_amount_tax).replace(',','#').replace('.',',').replace('#','.')" style="white-space: nowrap;"/>

                          </td>
                      </tr>
                      <tr>
                          <td class="noborder"/>
                          <td class="text-right"><strong>Total:</strong></td>
                          <td class="text-right-not-xs text-left-xs">
                              
                              <!--<strong t-field="order.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: order.pricelist_id.currency_id}"/>-->

                              <t t-set="tasa_amount_total" t-value="float(valor)*order.amount_total"></t>
                              <strong t-esc="to_symbol+' '+'{0:,.2f}'.format(tasa_amount_total).replace(',','#').replace('.',',').replace('#','.')" />



                          </td>
                      </tr>
                    </table>
                  </div>
                </t>




                </div>

                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button>
                </div>

              </div>
              
            </div>
          </div>
        </t>

        <!--Funcion que muestra las diferentes tasas de cambio dependiendo del boton pulsaodo-->
        <script>
        function toggle_rate_order(instancia){




        for(var div in document.getElementsByName("rate_per_divition")){

        if(!(document.getElementsByName("rate_per_divition")[div].id == undefined)){

        if (!(document.getElementById(instancia.value) == document.getElementsByName("rate_per_divition")[div].id)){
            document.getElementById(document.getElementsByName("rate_per_divition")[div].id).style = "display:none;"; 
        }
        }


        }
        document.getElementById(instancia.value).style="display:block;";
        }   
        </script>

        </xpath>

</template>
</data>
</odoo>